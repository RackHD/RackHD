<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>RackHD Benchmark Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../static/main.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
    <script src="../static/jquery.min.js"></script>
    <script src="../static/bootstrap/js/bootstrap.min.js"></script>
        
    <!-- Data for Table -->
    <script type="text/javascript" src="../data/summary.js"></script>
    <script type="text/javascript" src="../data/mongo_disk_summary.js"></script>
    <script type="text/javascript" src="../data/mongo_doc_summary.js"></script>
    <script type="text/javascript" src="../data/case_info.js"></script>
    <script type="text/javascript" src="config.js"></script>
    
    <script type="text/javascript">
    $(document).ready(function(){
        $("#case_name").append(case_info["case name"]);
        $("#case_log_path").append(case_info["log path"]);
        $("#case_start_time").append(case_info["time marker"]["start"]);
        $("#case_end_time").append(case_info["time marker"]["end"]);
        $("#node_finish_time").append(case_info["time marker"]["node finish"]);
        
        var case_data = case_info["log path"].split("-");
        var atop_statistics = eval("atop_statistics_"+case_data[0]+"_"+case_data[1]);
        var mongo_document_statistics = eval("mongo_document_statistics_"+case_data[0]+"_"+case_data[1]);
        var mongo_disk_statistics = eval("mongo_disk_statistics_"+case_data[0]+"_"+case_data[1]);
        
        var type_in_config = new Array();
        $.each(configuration, function(type, details){
            var count = Object.keys(details).length;
            $.each(details, function(datatype, dataconfig){
                type_in_config.push(datatype);
                
                var tr = document.createElement('tr');
                var td00 = document.createElement('td');
                td00.innerHTML = type;
                var td0 = document.createElement('td');
                var alink = document.createElement('a');
                alink.setAttribute("href", "#");
                alink.setAttribute("data-toggle", "tooltip");
                alink.setAttribute("data-html", "true");
                alink.setAttribute("data-placement", "right");
                alink.setAttribute("title", "<p align='left' style='width:400px;'>"+dataconfig["Description"]+"</p>");
                
                if(dataconfig["unit"] == "ms"){
                    alink.innerHTML = datatype + "(time)";
                }
                else{
                    alink.innerHTML = datatype + "(" + dataconfig["unit"] + ")";
                }
                td0.appendChild(alink);
                var td1 = document.createElement('td');
                td1.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["on-syslog"]), dataconfig["unit"]);
                var td2 = document.createElement('td');
                td2.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["on-tftp"]), dataconfig["unit"]);
                var td3 = document.createElement('td');
                td3.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["on-dhcp-proxy"]), dataconfig["unit"]);
                var td4 = document.createElement('td');
                td4.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["beam.smp"]), dataconfig["unit"]);
                var td5 = document.createElement('td');
                td5.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["on-taskgraph"]), dataconfig["unit"]);
                var td6 = document.createElement('td');
                td6.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["on-http"]), dataconfig["unit"]);
                var td7 = document.createElement('td');
                td7.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["dhcpd"]), dataconfig["unit"]);
                var td8 = document.createElement('td');
                td8.innerHTML = formatNumber(getSUMorMAX(atop_statistics[datatype]["mongod"]), dataconfig["unit"]);
                var td9 = document.createElement('td');
                if(dataconfig["sum"]==false){
                    td9.innerHTML = "N/A";
                }
                else{
                    td9.innerHTML = formatNumber(getTotal(atop_statistics, datatype), dataconfig["unit"]);
                }
                var td10 = document.createElement('td');
                td10.innerHTML = "<a href='"+datatype+".html"+"'>View Report</a>"
                
                tr.appendChild(td00);
                tr.appendChild(td0);
                tr.appendChild(td1);
                tr.appendChild(td2);
                tr.appendChild(td3);
                tr.appendChild(td4);
                tr.appendChild(td5);
                tr.appendChild(td6);
                tr.appendChild(td7);
                tr.appendChild(td8);
                tr.appendChild(td9);
                tr.appendChild(td10);
                
                $('#casesummarytable').append(tr);
            });
        });
        
        var mongo_disk_statistics_total = 0;
        $.each(mongo_disk_statistics, function(i, val){
            var tr = document.createElement('tr');
            var td0 = document.createElement('td');
            td0.innerHTML = i + "(byte)";
            var td1 = document.createElement('td');
            td1.innerHTML = shortNumber(val, "byte");
            
            tr.appendChild(td0);
            tr.appendChild(td1);
            
            mongo_disk_statistics_total = mongo_disk_statistics_total + val;
            
            $('#mongo_disk_statistics_body').append(tr);
        });
        // Total
        var tr = document.createElement('tr');
        var td0 = document.createElement('td');
        td0.innerHTML = "<b>Total (byte)</b>";
        var td1 = document.createElement('td');
        td1.innerHTML = shortNumber(mongo_disk_statistics_total, "byte");
        
        tr.appendChild(td0);
        tr.appendChild(td1);
        $('#mongo_disk_statistics_body').append(tr);
        
        var mongo_document_statistics_max_total = 0;
        var mongo_document_statistics_min_total = 0;
        var mongo_document_statistics_avg_total = 0;
        $.each(mongo_document_statistics, function(i, val){
            mongo_document_statistics_max_total = mongo_document_statistics_max_total + val["max"];
            mongo_document_statistics_min_total = mongo_document_statistics_min_total + val["min"];
            mongo_document_statistics_avg_total = mongo_document_statistics_avg_total + val["avg"];
            
            var tr = document.createElement('tr');
            var td0 = document.createElement('td');
            td0.innerHTML = i + "(byte)";
            var td1 = document.createElement('td');
            td1.innerHTML = shortNumber(val["max"], "byte");
            var td2 = document.createElement('td');
            td2.innerHTML = shortNumber(val["min"], "byte");
            var td3 = document.createElement('td');
            td3.innerHTML = shortNumber(val["avg"], "byte");
            
            tr.appendChild(td0);
            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            
            $('#mongo_document_statistics_body').append(tr);
        });
        // Total
        var tr = document.createElement('tr');
        var td0 = document.createElement('td');
        td0.innerHTML = "<b>Total (byte)</b>";
        var td1 = document.createElement('td');
        td1.innerHTML = shortNumber(mongo_document_statistics_max_total, "byte");
        var td2 = document.createElement('td');
        td2.innerHTML = shortNumber(mongo_document_statistics_min_total, "byte");
        var td3 = document.createElement('td');
        td3.innerHTML = shortNumber(mongo_document_statistics_avg_total, "byte");
        
        tr.appendChild(td0);
        tr.appendChild(td1);
        tr.appendChild(td2);
        tr.appendChild(td3);
        
        $('#mongo_document_statistics_body').append(tr);
        
        
        $('[data-toggle="tooltip"]').tooltip();   
        
        var tr = document.createElement('tr');
        var td = document.createElement('td');
        td.innerHTML = "<a href='MongoDoc.html"+"'>View Report</a>";
        td.setAttribute("colSpan", 4);
        tr.appendChild(td);
        $('#mongo_document_statistics_body').append(tr);
        
        var grid = $("#casesummarytable");
        var rowCount = grid.find("tr").length;
        var flagRow = grid.find("tr:eq("+rowCount+")").find("td:eq(0)").html(); 
        var sp = 0; 
        for(var i = rowCount; i >=0; i--) { 
            var tempRow = grid.find("tr:eq("+i+")"); 
            if(flagRow == tempRow.find("td:eq(0)").html()) { 
                tempRow.find("td:eq(0)").remove(); 
            } 
            else { 
                $("<td/>").attr("rowspan", rowCount-i-sp).html(flagRow).prependTo(tempRow.parent().find("tr:eq("+(i+1)+")")); 
                flagRow = tempRow.find("td:eq(0)").html(); 
                sp = rowCount-i; 
                if(i != 0) { 
                    tempRow.find("td:eq(0)").remove(); 
                }
            }
        }
    });
    
    function getSUMorMAX(dict){
        if(dict.hasOwnProperty('sum')){
            return dict["sum"];
        }
        else{
            return dict["max"];
        }
    }
    
    function getTotal(atop_statistics, datatype){
        list = ["on-syslog", "on-tftp", "on-dhcp-proxy", "beam.smp", "on-taskgraph", "on-http", "dhcpd", "mongod"];
        result = 0;
        $.each(list, function(index, data){
            result = result + getSUMorMAX(atop_statistics[datatype][data]);
        });
        return result;
    }
    
    function formatNumber(value, unit){
        if(unit=="%")            
        {
            return value;
        }
        else if(unit=="packets")
        {
            return addComma(value.toString());
        }
        else
        {
            return shortNumber(value, unit);
        }
    }
    
    function addComma(str) {
        if(str.length <= 3){
            return str;
        }
        else {
            return addComma(str.substr(0,str.length-3))+','+str.substr(str.length-3);
        }
    }
    
    function upgradeUnit(unit){
        switch (unit)
        {
            case "byte":
                unit =  "K";
                break;
            case "bps":
                unit =  "K";
                break;
            case "K":
                unit =  "M";
                break;
            case "M":
                unit = "G";
                break;
            case "G":
                unit = "T"; 
                break;
            case "ms":
                unit = "s";
                break;
            case "s":
                unit = "m";
                break;
            case "m":
                unit = "h";
                break;
            case "h":
                unit = "d";
                break;
            default:
                unit = unit;
        }
        return unit;
    }
    
    function shortNumber(value, unit){
        length = (value.toString().split(".")[0]).length;
        if(length<4){
            if(unit == "byte" || unit == "bps") {
                return value;
            }
            else {
                return value +" "+ unit;
            }
        }
        else
        {
            result = (value/1000).toFixed(2);
            newunit = upgradeUnit(unit);
            return shortNumber(result, newunit);
        }
    }
    
    </script>
</head>
<body>
    <header>
        <h2>RackHD Benchmark Report</h2>
    </header>
    <div class="container">
        <div class="well well-sm" style="margin-top:70px">
          <p id="case_name"><b>Case Name: </b></p>
          <p id="case_log_path"><b>Case Log Path: </b></p>
          <p id="case_start_time"><b>Case Start Time: </b></p>
          <p id="case_end_time"><b>Case End Time: </b></p>
          <p id="node_finish_time"><b>Node Finish Time: </b></p>
        </div>
        
        <div class="panel panel-success" style="width:100%; min-width: 800px;">
            <a href="#" class="list-group-item active">
            Summary Report
            </a>
            <table class="table table-hover" id="casesummarytable" style="width:100%; min-width: 800px;">
                <tr>
                    <td><b>Group</b></td>
                    <td><b>Measures</b></td>
                    <td><b>on-syslog</b></td>
                    <td><b>on-tftp</b></td>
                    <td><b>on-dhcp-proxy</b></td>
                    <td><b>beam.smp</b></td>
                    <td><b>on-taskgraph</b></td>
                    <td><b>on-http</b></td>
                    <td><b>dhcpd</b></td>
                    <td><b>mongod</b></td>
                    <td><b>Total</b></td>
                    <td><b>Graph Report</b></td>
                </tr>
            </table>
        </div>
    
        <table id="mongo_disk_statistics_table" style="width:100%">
            <tr>
                <td style="width:45%">
                    <div class="panel panel-warning">
                        <a href="#" class="list-group-item active">
                        Mongo Disk Statistics Table
                        </a>
                        <table class="table table-hover" id="mongo_disk_statistics_table">
                            <thead>
                                <th>Measures</th>
                                <th>Size</th>
                            </thead>
                            <tbody id="mongo_disk_statistics_body" name="mongo_disk_statistics_body">
                            </tbody>   
                        </table>
                    </div>
                </td>
                <td style="width:5%"></td>
                <td style="width:50%">
                    <div class="panel panel-warning">
                        <a href="#" class="list-group-item active">
                        Mongo Document Statistics Table
                        </a>
                        <table class="table table-hover" id="mongo_document_statistics_table">
                            <thead>
                                <th>Measures</th>
                                <th>max</th>
                                <th>min</th>
                                <th>avg</th>
                            </thead>
                            <tbody id="mongo_document_statistics_body" name="mongo_document_statistics_body">
                            </tbody>   
                        </table>
                    </div>
                </td>
            </tr>
        </table>
        
    </div>
</body>
</html>
