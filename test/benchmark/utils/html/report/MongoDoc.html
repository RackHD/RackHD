<!DOCTYPE html>
<html lang="en">
<head>
    <title>RackHD Benchmark Report</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../static/main.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        
    <!--
    For production (minified) code, use:
    <script type="text/javascript" src="dygraph-combined.js"></script>
    -->
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/dygraph/1.1.1/dygraph-combined.js"></script>
    <script type="text/javascript" src="smooth-plotter.js"></script>
    
    <!-- Data for chart -->
    <script type="text/javascript" src="../data/mongo_document.js"></script>
    
    <!-- Data for Table -->
    <script type="text/javascript" src="../data/mongo_doc_summary.js"></script>
    <script type="text/javascript" src="../data/case_info.js"></script>
    
</head>
<body>
    <header>
        <h2>RackHD Benchmark Report - Mongo Document</h2>
    </header>
    <div class="container">
        <div class="well well-sm">
            <ul class="fa-ul">
              <p id="case_name"><b>Case Name: </b></p>
              <p id="case_log_path"><b>Case Log Path: </b></p>
              <p id="case_start_time"><b>Case Start Time: </b></p>
              <p id="case_end_time"><b>Case End Time: </b></p>
              <p id="node_finish_time"><b>Node Finish Time: </b></p>
            </ul>
            <p><a href="summary.html">Back to Summary Report</a></p>
        </div>
        <div class="panel panel-info" style="width:99%">
            <div class="panel panel-success">
                <a href="#" class="list-group-item active">
                Mongo Document Report
                </a>
                <table class="table table-hover">
                    <thead>
                        <th style="width:20%">Process</th>
                        <th style="width:20%">Max</th>
                        <th style="width:20%">Min</th>
                        <th style="width:20%">Avg</th>
                        <th style="width:20%">Sum</th>
                    </thead>
                    <tbody id="usrcpubody" name="usrcpubody">
                    </tbody>   
                </table>
            </div>
            <div id="usrcpu_div" style="height: 400px;"></div>
        </div>
    </div>
    
    <script type="text/javascript">
    var case_data = case_info["log path"].split("-");
    var mongo_document_data = eval("mongo_document_data_"+case_data[0]+"_"+case_data[1]);
    var mongo_document_statistics_data = eval("mongo_document_statistics_"+case_data[0]+"_"+case_data[1]);
    
    
    $(document).ready(function(e) {
        $("#case_name").append(case_info["case name"]);
        $("#case_log_path").append(case_info["log path"]);
        $("#case_start_time").append(case_info["time marker"]["start"]);
        $("#case_end_time").append(case_info["time marker"]["end"]);
        $("#node_finish_time").append(case_info["time marker"]["node finish"]);
        
        $.each(mongo_document_statistics_data, function(process, value){
            var tr = document.createElement('tr');
            var td0 = document.createElement('td');
            td0.innerHTML = process + " (byte)";
            var td1 = document.createElement('td');
            td1.innerHTML = shortNumber(value["max"], "B");
            var td2 = document.createElement('td');
            td2.innerHTML = shortNumber(value["min"], "B");
            var td3 = document.createElement('td');
            td3.innerHTML = shortNumber(value["avg"].toFixed(2), "B");
            var td4 = document.createElement('td');
            td4.innerHTML = "N/A";
            
            tr.appendChild(td0);
            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            tr.appendChild(td4);
            
            $('#usrcpubody').append(tr);
        })
    });

    smoothPlotter.smoothing = 1;
    function zeropad(x) {
        return (x < 10) ? '0' + x : x;
      }
      
    gu = new Dygraph(document.getElementById("usrcpu_div"),
        mongo_document_data,
        {
          rollPeriod: 1,
          legend: 'always',
          title: 'Mongo Document Report',
          titleHeight: 32,
          ylabel: 'mili-second (ms)',
          xlabel: 'Seconds (from test start)',
          labelsDivStyles: {
          'text-align': 'right',
          'background': 'none'
          },
          axes: {
                x: {
                  axisLabelWidth: 70,
                  axisLabelFormatter: function(d, gran) {
                    return zeropad(d.getHours()) + ":"
                        + zeropad(d.getMinutes()) + ":"
                        + zeropad(d.getSeconds());
                  }
                }
          },
          strokeWidth: 2,
          customBars: false,
          logscale: false
        });

    annotations = [];
    annotations.push( {
          series: 'on-http',
          x: "2016-03-11 07:19:13",
          shortText: 'S',
          text: 'Start of discovery',
          icon: 'start.png',
          width: 18,
          height: 23,
          tickHeight: 4,
          attachAtBottom: true
        } )
    annotations.push( {
          series: 'on-http',
          x: "2016-03-11 08:11:17",
          shortText: 'E',
          text: 'End of discovery',
          icon: 'stop.png',
          width: 18,
          height: 23,
          tickHeight: 4,
          attachAtBottom: true
        } )
    gs.setAnnotations(annotations);
    
    function shortNumber(value, unit){
        length = (value.toString().split(".")[0]).length;
        if(length<4){
            if(unit == "B" || unit == "bps") {
                return value;
            }
            else {
                return value +" "+ unit;
            }
        }
        else
        {
            result = (value/1000).toFixed(2);
            newunit = upgradeUnit(unit);
            return shortNumber(result, newunit);
        }
    }
    
    function upgradeUnit(unit){
            switch (unit)
            {
                case "B":
                    unit =  "K";
                    break;
                case "bps":
                    unit =  "K";
                    break;
                case "K":
                    unit =  "M";
                    break;
                case "M":
                    unit = "G";
                    break;
                case "G":
                    unit = "T"; 
                    break;
                case "ms":
                    unit = "s";
                    break;
                case "s":
                    unit = "m";
                    break;
                case "m":
                    unit = "h";
                    break;
                case "h":
                    unit = "d";
                    break;
                default:
                    unit = unit;
            }
            return unit;
        }
    </script>
</body>
</html>
